{% extends "base.html" %}
{% load static %}
{% block css %}
    <link rel='stylesheet' href='{% static "css/index.css" %}' />
{% endblock %}

{% block title %}test{% endblock %}
{% block main %}
    <div id='formarea'>
        <form action='' method="get">
            <li>Productname:  <input type="text" name="productName" placeholder="keywords"/></li>
            <li>Price:  <input type="text" name="startp" placeholder="Low"/>~<input type="text" name="endp" placeholder="High"/></li>
            Sorted: 
            <select name='sort'>
                <option value='price'>Up</option>
                <option value='-price'>Down</option>
            </select>
            <li><input type='submit' value='Search'></li>
        </form>
    </div>
    <div class='info'>
        {% for p in outPut %}
            <div class= 'infoarea'>
                <ul>
                    <form method='post'>
                        {% csrf_token %}
                        <li><a href={{ p.url }}><img src= {{ p.photo_url }}></a></li>
                        <li>商品編號: {{ p.pid }}</li>
                        <li>商品名稱: {{ p.name }}</li>
                        <li>價錢: {{ p.price }}</li>
                        <li>購買數量: <input name='num'  type='number' step='1' min='1' max='10'/></li>
                        <input type='hidden' name='buydetail' value='{{ p.pid }},{{ p.name }},{{ p.price }}'/></li>
                        <li><input type='submit' value='加入購物車'></li>
                    </form>
                </ul>
            </div>                                                  
        {% endfor %}
    </div>
    <div class="pagination">
        <span class="page_link">
            {% if outPut.has_previous %}
                <a href="?page={{ outPut.previous_page_number }}&productName={{ productname }}&startp={{ startp }}&endp={{ endp }}">Previous</a>
            {% endif %}
            <span class="current">
                pages:{{ outPut.number }} of {{ outPut.paginator.num_pages }}
            </span>
            {% if outPut.has_next %}
                <a href="?page={{ outPut.next_page_number }}&productName={{ productname }}&startp={{ startp  }}&endp={{ endp }}">Next</a>
            {% endif %}
        </span>
    </div>
{% endblock %}
{% block script %}
<script>
    function sendtoSC(pid,pn,pp) {

        var num=document.getElementsByClassName(pid+"_buyNum");

        console.log(pn,pp,num[0].value);

        var obj = {
            "pid":pid,
            "pn":pn,
            "pp":pp,
            "num":num[0].value
        };

        var myjson = JSON.stringify(obj);

        fetch('http://127.0.0.1:8000/Product/shopping',{
            method: "POST",
            headers: {

                'Content-Type':'application/json',
            },
            
            body:myjson,
        }).then((response)=>{
            return response.text();
        })
    };
</script>
{% endblock %}
